---
title: "HTTPS 分享"
date: 2023-09-12T00:23:00+08:00
tags: [https,cryptography]
toc: true
---

## 引言

这是2019年3月一次内部技术分享，当时在笔记上留下了一些大纲，分享时的PPT已经不见了，借此机会再写一遍分享内容，于自己是一次知识巩固，于朋友们也算得上是一次技术交流。

## 先聊聊密码学

谈到HTTPS，大家首先想到的是安全和加密通信。所以在开始HTTPS之旅前，有必要先聊一些密码学的内容。

### 古典密码

密码并不是一个很新潮的技术，我甚至怀疑从有人类文明开始，密码技术就诞生了。毕竟我们每个人心底里都藏着那没多不想让人知道的秘密😊

我们先来看看比较古老的密码。

#### 密码棒

密码棒是一种非常古老的密码，看着也有点像小时候的游戏。用一个纸条或者布条缠绕在有多个面（例如4个面）的棒子上，然后竖着在每个面上写字，写完后将纸条或者布条拉直，这时候得到的就是被打乱顺序的文字了。这也算得上一种密码吧！

{{< figureCupper
img="figure1-scytale.png"
caption="密码棒 参考[wiki](https://zh.wikipedia.org/wiki/密碼棒)"
command="Resize"
options="260x" >}}

间接的证据指出，最早提到密码棒的是一位公元前7世纪的希腊诗人阿尔基罗库斯，后来的希腊和罗马作家也在作品提到。

希腊历史学家普鲁塔克（Plutarch）曾写下密码棒的用法

wiki 上给了一个例子，按照上述方法处理 "Help me I am under attack" 这句话，加解密过程为：

加密过程：明文4个文字绕一圈，所以可以绕棒子5圈，故我们按照5个文字分一组，然后竖着读取每一列。（想象一下）：

```
H E L P M
E I A M U
N D E R A
T T A C K
```

得到密文：

```
HENTEIDTLAEAPMRCMUAK
```

解密过程则相反：将密文4个文字一组分组（每间隔3个文字取一个，到尾部后绕回即可。）

```
H E N T---------
E I D T---------
L A E A--------
P M R C---------
M U A K---------
```

得到明文：

```
HELPMEIAMUNDERATTACK
```


#### 凯撒密码

凯撒密码，即是人们常说的变换加密，根据苏维托尼乌斯的记载，凯撒曾用此方法对重要的军事信息进行加密。

{{< figureCupper
img="figure2-caesar-cipher.png"
caption="凯撒密码 参考[wiki](https://zh.wikipedia.org/wiki/凱撒密碼)"
command="Resize"
options="480x" >}}

对于字母文字而言，可以理解为按照一个固定的偏移量在字母表上将原始字母替换成目标字母。其变种也可以是预先设置好原始字母表和目标字母表的映射关系，然后做字母替换。

针对第一种情况，在偏移量为3时的一个例子

```
# 字母表
ABCDEFGHIJKLMNOPQRSTUVWXYZ
DEFGHIJKLMNOPQRSTUVWXYZABC

# 明文
THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG

# 密文
WKH TXLFN EURZQ IRA MXPSV RYHU WKH ODCB GRJ
```

如何破解这种密码呢？各位思考一下。

#### 维吉尼亚密码

维吉尼亚密码可以算是一种凯撒密码的变种，是使用一系列凯撒密码组成密码字母表的加密算法。详细信息各位可以去[wiki](https://zh.wikipedia.org/wiki/维吉尼亚密码)上阅读。这里我们给一个示例。

{{< figureCupper
img="figure3-Vigenère-square.png"
caption="维吉尼亚密码"
command="Resize"
options="480x" >}}

在一个凯撒密码中，字母表中的每一字母都会作一定的偏移，例如偏移量为3时，A就转换为了D、B转换为了E……而维吉尼亚密码则是由一些偏移量不同的凯撒密码组成。

为了生成密码，需要使用表格法。这一表格包括了26行字母表，每一行都由前一行向左偏移一位得到。具体使用哪一行字母表进行编译是基于密钥进行的，在过程中会不断地变换。

```
# 明文
ATTACKATDAWN

# 密钥
LEMONLEMONLE

# 密文
LXFOPVEFRNHR
```

其解密过程反向操作即可。

如何破解这种密码呢？各位思考一下。

#### 谜码机

恩尼格玛密码机（德语：Enigma，又译恩尼格密码机、哑谜机、奇谜机[1]或谜式密码机）是一种用于加密与解密文件的密码机。确切地说，恩尼格玛是对二战时期纳粹德国使用的一系列相似的转子机械加解密机器的统称，它包括了许多不同的型号，为密码学对称加密算法的流加密。

{{< figureCupper
img="figure4-enigma.jpg"
caption="Egigma 密码机"
command="Resize"
options="480x" >}}

关于谜码机的加密原理我一时之间也搞不清楚，要知道祖师爷 **图灵** 为了破译这个密码都费了老大的功夫了（据说还是没有完成破译工作，对破译工作做出杰出贡献的是三位波兰密码学家马里安·雷耶夫斯基、杰尔兹·罗佐基和亨里克·佐加尔斯基）。详细的内容各位可以参考[wiki](https://zh.wikipedia.org/wiki/恩尼格玛密码机)上的介绍。

如果仅仅对故事感兴趣，大家可以去看看《模仿游戏》这部电影。

{{< figureCupper
img="figure5-the-imitation-game.jpg"
caption="电影《模仿游戏》"
command="Resize"
options="960x" >}}

#### 一次性密码本

[wiki](https://zh.wikipedia.org/wiki/一次性密碼本) 上的介绍

一次性密码本（英语：one-time pad，缩写为OTP）是古典密码学中的一种加密算法。是以随机的密钥（key）加密明文，且只使用一次。

在理论上，此种密码具有完善保密性，是牢不可破的。它的安全性已由克劳德·艾尔伍德·香农所证明。
虽然它在理论上的安全性无庸置疑，但在实际操作上却有着以下的问题：

* 用以加密的文本，也就是一次性密码本，必须确实是随机产生的。
* 它至少必须和被加密的文件等长。
* 用以加密的文本只能用一次，且必须对非关系人小心保密，不再使用时，用以加密的文本应当要销毁，以防重复使用。

文中给了一个说明和例子：

> 首先手上要有一本一次性密码本用以加密文件，接着将一次性密码本里的字母，与被加密文件的字母给依序按某个事先约定的规定一一相混，其中一个相混的作法是将字母指定数字（如在英语中，将A至Z依序指定为0至25）然后将一次性密码文本上的字母所代表的数字和被加密文件上相对应的数字给相加，再除以该语言的字母数后获取其余数，假设字母数是 n（如英语为26），若就此得出来的某个数字小于零，则将该小于零的数给加上n，如此便完成加密。

```
# 明文
This is an example → 19 7 8 18 8 18 0 13 4 23 0 12 15 11 4

# 一次性密码本
MASKL NSFLD FKJPQ → 12 0 18 10 11 13 18 5 11 3 5 10 9 15 16

# 相加
31 7 26 28 19 31 18 18 15 26 5 22 24 26 20

# 取余
5 7 0 2 19 5 18 18 15 0 5 22 24 0 20

# 密文
FHACTFSSPAFWYAU
```

其解密过程反向操作即可。

### 现代密码的工具箱

前边介绍了一些古典加密方法，有简单有复杂，有不安全有安全，但是在我们即将介绍的HTTPS这个场景下，多少有些不适用之处。

这个时候现代密码学工具就要派上用场了。

#### 对称加密

#### 非对称加密（公钥加密）

#### 单向散列函数

#### 消息确认码

#### 数字签名

#### 伪随机数生成器


## 为什么是HTTPS

### HTTP演进历史

### 什么是HTTPS

### 如何实现安全传输


## 有关数字证书

### 数字证书

### 验证过程

### 证书链

### 证书获取方式

### Let's Encrypt

## 参考

* [《图解密码技术》](https://www.ituring.com.cn/book/1737)
* [《HTTPS权威指南》](https://www.ituring.com.cn/book/1734) 
* Let's Encrypt [官方网站](https://letsencrypt.org/zh-cn/)

再多的参考资料都不如自己动手实践，共勉！


